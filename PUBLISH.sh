#!/bin/bash
# ============================================================
#  Port Manager - マーケットプレース公開手順
# ============================================================
#
#  このスクリプトは手順メモです。上から順に実行してください。
#
# ============================================================

echo "
╔══════════════════════════════════════════════════════╗
║       ⚡ Port Manager 公開手順ガイド                ║
╚══════════════════════════════════════════════════════╝

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

 STEP 1: Azure DevOps で Personal Access Token を取得
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  1. https://dev.azure.com にアクセス (Microsoftアカウントでログイン)
  2. 右上のユーザーアイコン → Personal access tokens
  3. 「New Token」をクリック
  4. 以下を設定:
     - Name: vsce-publish (任意)
     - Organization: All accessible organizations
     - Expiration: 必要な期間
     - Scopes: 「Custom defined」→「Marketplace」→「Manage」にチェック
  5. 「Create」→ トークンをコピーして保存

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

 STEP 2: Publisher を作成
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  1. https://marketplace.visualstudio.com/manage にアクセス
  2. 「Create Publisher」をクリック
  3. Publisher ID に package.json の \"publisher\" と同じ値を設定
     → 現在: \"saiki\"  (好きな名前に変更可)
  4. 表示名やメールアドレスを入力して作成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

 STEP 3: vsce をインストール & パッケージング
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
"

echo "  # vsce をグローバルインストール"
echo "  npm install -g @vscode/vsce"
echo ""
echo "  # このディレクトリに移動"
echo "  cd port-manager-marketplace"
echo ""
echo "  # .vsix パッケージを作成"
echo "  vsce package"
echo "  # → port-manager-1.0.0.vsix が生成される"
echo ""
echo "
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

 STEP 4: 公開前テスト (任意だけどおすすめ)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  # .vsixファイルを手動インストールしてテスト
  code --install-extension port-manager-1.0.0.vsix

  # 動作確認ポイント:
  #   ✅ サイドバーに Port Manager アイコンが出る
  #   ✅ ポート一覧が表示される
  #   ✅ 検索・ソートが動く
  #   ✅ KILLボタンで確認ダイアログが出る
  #   ✅ コマンドパレットから3つのコマンドが使える

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

 STEP 5: マーケットプレースに公開
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  # ログイン (STEP1で取得したトークンを入力)
  vsce login saiki

  # 公開！
  vsce publish

  # または、ログインなしでトークン直接指定
  vsce publish -p YOUR_ACCESS_TOKEN

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

 STEP 6: バージョンアップ時
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  # パッチバージョンアップ (1.0.0 → 1.0.1)
  vsce publish patch

  # マイナーバージョンアップ (1.0.0 → 1.1.0)
  vsce publish minor

  # メジャーバージョンアップ (1.0.0 → 2.0.0)
  vsce publish major

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

 スクリーンショットについて
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  README.md に images/screenshot.png を参照しています。
  公開前にVSCodeで実際に動かしたスクリーンショットを
  images/screenshot.png として保存してください。

  推奨サイズ: 1280x800 程度

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
"
